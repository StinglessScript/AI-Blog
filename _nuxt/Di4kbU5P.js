var pe=Object.defineProperty;var ye=(n,t,e)=>t in n?pe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var k=(n,t,e)=>ye(n,typeof t!="symbol"?t+"":t,e);import{c as be,g as Se}from"./dAbDOcYM.js";import{t as Te,F as N,I as K,E as te,R as _e,T as we}from"./DGBHXtJB.js";import"./CuGlreuw.js";import"./bNaE6FFb.js";import"./CiDwHVmI.js";let E=class extends Error{constructor(t){super(t),this.name="ShikiError"}};function ke(n){return Array.isArray(n)?n:[n]}function H(n,t=!1){var o;const e=n.split(/(\r?\n)/g);let r=0;const s=[];for(let a=0;a<e.length;a+=2){const c=t?e[a]+(e[a+1]||""):e[a];s.push([c,r]),r+=e[a].length,r+=((o=e[a+1])==null?void 0:o.length)||0}return s}function Y(n){return!n||["plaintext","txt","text","plain"].includes(n)}function Le(n){return n==="ansi"||Y(n)}function q(n){return n==="none"}function Ce(n){return q(n)}function ce(n,t){var r;if(!t)return n;n.properties||(n.properties={}),(r=n.properties).class||(r.class=[]),typeof n.properties.class=="string"&&(n.properties.class=n.properties.class.split(/\s+/g)),Array.isArray(n.properties.class)||(n.properties.class=[]);const e=Array.isArray(t)?t:t.split(/\s+/g);for(const s of e)s&&!n.properties.class.includes(s)&&n.properties.class.push(s);return n}function ve(n,t){let e=0;const r=[];for(const s of t)s>e&&r.push({...n,content:n.content.slice(e,s),offset:n.offset+e}),e=s;return e<n.content.length&&r.push({...n,content:n.content.slice(e),offset:n.offset+e}),r}function Ne(n,t){const e=Array.from(t instanceof Set?t:new Set(t)).sort((r,s)=>r-s);return e.length?n.map(r=>r.flatMap(s=>{const o=e.filter(a=>s.offset<a&&a<s.offset+s.content.length).map(a=>a-s.offset).sort((a,c)=>a-c);return o.length?ve(s,o):s})):n}async function le(n){return Promise.resolve(typeof n=="function"?n():n).then(t=>t.default||t)}function W(n,t){const e=typeof n=="string"?{}:{...n.colorReplacements},r=typeof n=="string"?n:n.name;for(const[s,o]of Object.entries((t==null?void 0:t.colorReplacements)||{}))typeof o=="string"?e[s]=o:s===r&&Object.assign(e,o);return e}function $(n,t){return n&&((t==null?void 0:t[n==null?void 0:n.toLowerCase()])||n)}function fe(n){const t={};return n.color&&(t.color=n.color),n.bgColor&&(t["background-color"]=n.bgColor),n.fontStyle&&(n.fontStyle&N.Italic&&(t["font-style"]="italic"),n.fontStyle&N.Bold&&(t["font-weight"]="bold"),n.fontStyle&N.Underline&&(t["text-decoration"]="underline")),t}function xe(n){return typeof n=="string"?n:Object.entries(n).map(([t,e])=>`${t}:${e}`).join(";")}function $e(n){const t=H(n,!0).map(([s])=>s);function e(s){if(s===n.length)return{line:t.length-1,character:t[t.length-1].length};let o=s,a=0;for(const c of t){if(o<c.length)break;o-=c.length,a++}return{line:a,character:o}}function r(s,o){let a=0;for(let c=0;c<s;c++)a+=t[c].length;return a+=o,a}return{lines:t,indexToPos:e,posToIndex:r}}class w extends Error{constructor(t){super(t),this.name="ShikiError"}}const ue=new WeakMap;function z(n,t){ue.set(n,t)}function R(n){return ue.get(n)}class O{constructor(...t){k(this,"_stacks",{});k(this,"lang");if(t.length===2){const[e,r]=t;this.lang=r,this._stacks=e}else{const[e,r,s]=t;this.lang=r,this._stacks={[s]:e}}}get themes(){return Object.keys(this._stacks)}get theme(){return this.themes[0]}get _stack(){return this._stacks[this.theme]}static initial(t,e){return new O(Object.fromEntries(ke(e).map(r=>[r,K])),t)}getInternalStack(t=this.theme){return this._stacks[t]}get scopes(){return ne(this._stacks[this.theme])}getScopes(t=this.theme){return ne(this._stacks[t])}toJSON(){return{lang:this.lang,theme:this.theme,themes:this.themes,scopes:this.scopes}}}function ne(n){const t=[],e=new Set;function r(s){var a;if(e.has(s))return;e.add(s);const o=(a=s==null?void 0:s.nameScopesList)==null?void 0:a.scopeName;o&&t.push(o),s.parent&&r(s.parent)}return r(n),t}function Ie(n,t){if(!(n instanceof O))throw new w("Invalid grammar state");return n.getInternalStack(t)}function Ee(){const n=new WeakMap;function t(e){if(!n.has(e.meta)){let r=function(a){if(typeof a=="number"){if(a<0||a>e.source.length)throw new w(`Invalid decoration offset: ${a}. Code length: ${e.source.length}`);return{...s.indexToPos(a),offset:a}}else{const c=s.lines[a.line];if(c===void 0)throw new w(`Invalid decoration position ${JSON.stringify(a)}. Lines length: ${s.lines.length}`);if(a.character<0||a.character>c.length)throw new w(`Invalid decoration position ${JSON.stringify(a)}. Line ${a.line} length: ${c.length}`);return{...a,offset:s.posToIndex(a.line,a.character)}}};const s=$e(e.source),o=(e.options.decorations||[]).map(a=>({...a,start:r(a.start),end:r(a.end)}));Me(o),n.set(e.meta,{decorations:o,converter:s,source:e.source})}return n.get(e.meta)}return{name:"shiki:decorations",tokens(e){var a;if(!((a=this.options.decorations)!=null&&a.length))return;const s=t(this).decorations.flatMap(c=>[c.start.offset,c.end.offset]);return Ne(e,s)},code(e){var u;if(!((u=this.options.decorations)!=null&&u.length))return;const r=t(this),s=Array.from(e.children).filter(h=>h.type==="element"&&h.tagName==="span");if(s.length!==r.converter.lines.length)throw new w(`Number of lines in code element (${s.length}) does not match the number of lines in the source (${r.converter.lines.length}). Failed to apply decorations.`);function o(h,f,d,y){const S=s[h];let g="",m=-1,p=-1;if(f===0&&(m=0),d===0&&(p=0),d===Number.POSITIVE_INFINITY&&(p=S.children.length),m===-1||p===-1)for(let T=0;T<S.children.length;T++)g+=he(S.children[T]),m===-1&&g.length===f&&(m=T+1),p===-1&&g.length===d&&(p=T+1);if(m===-1)throw new w(`Failed to find start index for decoration ${JSON.stringify(y.start)}`);if(p===-1)throw new w(`Failed to find end index for decoration ${JSON.stringify(y.end)}`);const b=S.children.slice(m,p);if(!y.alwaysWrap&&b.length===S.children.length)c(S,y,"line");else if(!y.alwaysWrap&&b.length===1&&b[0].type==="element")c(b[0],y,"token");else{const T={type:"element",tagName:"span",properties:{},children:b};c(T,y,"wrapper"),S.children.splice(m,b.length,T)}}function a(h,f){s[h]=c(s[h],f,"line")}function c(h,f,d){var g;const y=f.properties||{},S=f.transform||(m=>m);return h.tagName=f.tagName||"span",h.properties={...h.properties,...y,class:h.properties.class},(g=f.properties)!=null&&g.class&&ce(h,f.properties.class),h=S(h,d)||h,h}const i=[],l=r.decorations.sort((h,f)=>f.start.offset-h.start.offset);for(const h of l){const{start:f,end:d}=h;if(f.line===d.line)o(f.line,f.character,d.character,h);else if(f.line<d.line){o(f.line,f.character,Number.POSITIVE_INFINITY,h);for(let y=f.line+1;y<d.line;y++)i.unshift(()=>a(y,h));o(d.line,0,d.character,h)}}i.forEach(h=>h())}}}function Me(n){for(let t=0;t<n.length;t++){const e=n[t];if(e.start.offset>e.end.offset)throw new w(`Invalid decoration range: ${JSON.stringify(e.start)} - ${JSON.stringify(e.end)}`);for(let r=t+1;r<n.length;r++){const s=n[r],o=e.start.offset<s.start.offset&&s.start.offset<e.end.offset,a=e.start.offset<s.end.offset&&s.end.offset<e.end.offset,c=s.start.offset<e.start.offset&&e.start.offset<s.end.offset,i=s.start.offset<e.end.offset&&e.end.offset<s.end.offset;if(o||a||c||i){if(a&&a||c&&i)continue;throw new w(`Decorations ${JSON.stringify(e.start)} and ${JSON.stringify(s.start)} intersect.`)}}}}function he(n){return n.type==="text"?n.value:n.type==="element"?n.children.map(he).join(""):""}const Oe=[Ee()];function B(n){return[...n.transformers||[],...Oe]}var I=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],U={1:"bold",2:"dim",3:"italic",4:"underline",7:"reverse",9:"strikethrough"};function je(n,t){const e=n.indexOf("\x1B[",t);if(e!==-1){const r=n.indexOf("m",e);return{sequence:n.substring(e+2,r).split(";"),startPosition:e,position:r+1}}return{position:n.length}}function se(n,t){let e=1;const r=n[t+e++];let s;if(r==="2"){const o=[n[t+e++],n[t+e++],n[t+e]].map(a=>Number.parseInt(a));o.length===3&&!o.some(a=>Number.isNaN(a))&&(s={type:"rgb",rgb:o})}else if(r==="5"){const o=Number.parseInt(n[t+e]);Number.isNaN(o)||(s={type:"table",index:Number(o)})}return[e,s]}function Ge(n){const t=[];for(let e=0;e<n.length;e++){const r=n[e],s=Number.parseInt(r);if(!Number.isNaN(s))if(s===0)t.push({type:"resetAll"});else if(s<=9)U[s]&&t.push({type:"setDecoration",value:U[s]});else if(s<=29){const o=U[s-20];o&&t.push({type:"resetDecoration",value:o})}else if(s<=37)t.push({type:"setForegroundColor",value:{type:"named",name:I[s-30]}});else if(s===38){const[o,a]=se(n,e);a&&t.push({type:"setForegroundColor",value:a}),e+=o}else if(s===39)t.push({type:"resetForegroundColor"});else if(s<=47)t.push({type:"setBackgroundColor",value:{type:"named",name:I[s-40]}});else if(s===48){const[o,a]=se(n,e);a&&t.push({type:"setBackgroundColor",value:a}),e+=o}else s===49?t.push({type:"resetBackgroundColor"}):s>=90&&s<=97?t.push({type:"setForegroundColor",value:{type:"named",name:I[s-90+8]}}):s>=100&&s<=107&&t.push({type:"setBackgroundColor",value:{type:"named",name:I[s-100+8]}})}return t}function Re(){let n=null,t=null,e=new Set;return{parse(r){const s=[];let o=0;do{const a=je(r,o),c=a.sequence?r.substring(o,a.startPosition):r.substring(o);if(c.length>0&&s.push({value:c,foreground:n,background:t,decorations:new Set(e)}),a.sequence){const i=Ge(a.sequence);for(const l of i)l.type==="resetAll"?(n=null,t=null,e.clear()):l.type==="resetForegroundColor"?n=null:l.type==="resetBackgroundColor"?t=null:l.type==="resetDecoration"&&e.delete(l.value);for(const l of i)l.type==="setForegroundColor"?n=l.value:l.type==="setBackgroundColor"?t=l.value:l.type==="setDecoration"&&e.add(l.value)}o=a.position}while(o<r.length);return s}}}var Ae={black:"#000000",red:"#bb0000",green:"#00bb00",yellow:"#bbbb00",blue:"#0000bb",magenta:"#ff00ff",cyan:"#00bbbb",white:"#eeeeee",brightBlack:"#555555",brightRed:"#ff5555",brightGreen:"#00ff00",brightYellow:"#ffff55",brightBlue:"#5555ff",brightMagenta:"#ff55ff",brightCyan:"#55ffff",brightWhite:"#ffffff"};function We(n=Ae){function t(c){return n[c]}function e(c){return`#${c.map(i=>Math.max(0,Math.min(i,255)).toString(16).padStart(2,"0")).join("")}`}let r;function s(){if(r)return r;r=[];for(let l=0;l<I.length;l++)r.push(t(I[l]));let c=[0,95,135,175,215,255];for(let l=0;l<6;l++)for(let u=0;u<6;u++)for(let h=0;h<6;h++)r.push(e([c[l],c[u],c[h]]));let i=8;for(let l=0;l<24;l++,i+=10)r.push(e([i,i,i]));return r}function o(c){return s()[c]}function a(c){switch(c.type){case"named":return t(c.name);case"rgb":return e(c.rgb);case"table":return o(c.index)}}return{value:a}}function Be(n,t,e){const r=W(n,e),s=H(t),o=We(Object.fromEntries(I.map(c=>{var i;return[c,(i=n.colors)==null?void 0:i[`terminal.ansi${c[0].toUpperCase()}${c.substring(1)}`]]}))),a=Re();return s.map(c=>a.parse(c[0]).map(i=>{let l,u;i.decorations.has("reverse")?(l=i.background?o.value(i.background):n.bg,u=i.foreground?o.value(i.foreground):n.fg):(l=i.foreground?o.value(i.foreground):n.fg,u=i.background?o.value(i.background):void 0),l=$(l,r),u=$(u,r),i.decorations.has("dim")&&(l=Fe(l));let h=N.None;return i.decorations.has("bold")&&(h|=N.Bold),i.decorations.has("italic")&&(h|=N.Italic),i.decorations.has("underline")&&(h|=N.Underline),{content:i.value,offset:c[1],color:l,bgColor:u,fontStyle:h}}))}function Fe(n){const t=n.match(/#([0-9a-f]{3})([0-9a-f]{3})?([0-9a-f]{2})?/);if(t)if(t[3]){const r=Math.round(Number.parseInt(t[3],16)/2).toString(16).padStart(2,"0");return`#${t[1]}${t[2]}${r}`}else return t[2]?`#${t[1]}${t[2]}80`:`#${Array.from(t[1]).map(r=>`${r}${r}`).join("")}80`;const e=n.match(/var\((--[\w-]+-ansi-[\w-]+)\)/);return e?`var(${e[1]}-dim)`:n}function Q(n,t,e={}){const{lang:r="text",theme:s=n.getLoadedThemes()[0]}=e;if(Y(r)||q(s))return H(t).map(i=>[{content:i[0],offset:i[1]}]);const{theme:o,colorMap:a}=n.setTheme(s);if(r==="ansi")return Be(o,t,e);const c=n.getLanguage(r);if(e.grammarState){if(e.grammarState.lang!==c.name)throw new E(`Grammar state language "${e.grammarState.lang}" does not match highlight language "${c.name}"`);if(!e.grammarState.themes.includes(o.name))throw new E(`Grammar state themes "${e.grammarState.themes}" do not contain highlight theme "${o.name}"`)}return De(t,c,o,a,e)}function Pe(...n){if(n.length===2)return R(n[1]);const[t,e,r={}]=n,{lang:s="text",theme:o=t.getLoadedThemes()[0]}=r;if(Y(s)||q(o))throw new E("Plain language does not have grammar state");if(s==="ansi")throw new E("ANSI language does not have grammar state");const{theme:a,colorMap:c}=t.setTheme(o),i=t.getLanguage(s);return new O(F(e,i,a,c,r).stateStack,i.name,a.name)}function De(n,t,e,r,s){const o=F(n,t,e,r,s),a=new O(F(n,t,e,r,s).stateStack,t.name,e.name);return z(o.tokens,a),o.tokens}function F(n,t,e,r,s){const o=W(e,s),{tokenizeMaxLineLength:a=0,tokenizeTimeLimit:c=500}=s,i=H(n);let l=s.grammarState?Ie(s.grammarState,e.name)??K:s.grammarContextCode!=null?F(s.grammarContextCode,t,e,r,{...s,grammarState:void 0,grammarContextCode:void 0}).stateStack:K,u=[];const h=[];for(let f=0,d=i.length;f<d;f++){const[y,S]=i[f];if(y===""){u=[],h.push([]);continue}if(a>0&&y.length>=a){u=[],h.push([{content:y,offset:S,color:"",fontStyle:0}]);continue}let g,m,p;s.includeExplanation&&(g=t.tokenizeLine(y,l),m=g.tokens,p=0);const b=t.tokenizeLine2(y,l,c),T=b.tokens.length/2;for(let L=0;L<T;L++){const x=b.tokens[2*L],_=L+1<T?b.tokens[2*L+2]:y.length;if(x===_)continue;const C=b.tokens[2*L+1],A=$(r[te.getForeground(C)],o),j=te.getFontStyle(C),J={content:y.substring(x,_),offset:S+x,color:A,fontStyle:j};if(s.includeExplanation){const Z=[];if(s.includeExplanation!=="scopeName")for(const v of e.settings){let M;switch(typeof v.scope){case"string":M=v.scope.split(/,/).map(V=>V.trim());break;case"object":M=v.scope;break;default:continue}Z.push({settings:v,selectors:M.map(V=>V.split(/ /))})}J.explanation=[];let ee=0;for(;x+ee<_;){const v=m[p],M=y.substring(v.startIndex,v.endIndex);ee+=M.length,J.explanation.push({content:M,scopes:s.includeExplanation==="scopeName"?He(v.scopes):ze(Z,v.scopes)}),p+=1}}u.push(J)}h.push(u),u=[],l=b.ruleStack}return{tokens:h,stateStack:l}}function He(n){return n.map(t=>({scopeName:t}))}function ze(n,t){const e=[];for(let r=0,s=t.length;r<s;r++){const o=t[r];e[r]={scopeName:o,themeMatches:Ve(n,o,t.slice(0,r))}}return e}function re(n,t){return n===t||t.substring(0,n.length)===n&&t[n.length]==="."}function Je(n,t,e){if(!re(n[n.length-1],t))return!1;let r=n.length-2,s=e.length-1;for(;r>=0&&s>=0;)re(n[r],e[s])&&(r-=1),s-=1;return r===-1}function Ve(n,t,e){const r=[];for(const{selectors:s,settings:o}of n)for(const a of s)if(Je(a,t,e)){r.push(o);break}return r}function ge(n,t,e){const r=Object.entries(e.themes).filter(i=>i[1]).map(i=>({color:i[0],theme:i[1]})),s=r.map(i=>{const l=Q(n,t,{...e,theme:i.theme}),u=R(l),h=typeof i.theme=="string"?i.theme:i.theme.name;return{tokens:l,state:u,theme:h}}),o=Ue(...s.map(i=>i.tokens)),a=o[0].map((i,l)=>i.map((u,h)=>{const f={content:u.content,variants:{},offset:u.offset};return"includeExplanation"in e&&e.includeExplanation&&(f.explanation=u.explanation),o.forEach((d,y)=>{const{content:S,explanation:g,offset:m,...p}=d[l][h];f.variants[r[y].color]=p}),f})),c=s[0].state?new O(Object.fromEntries(s.map(i=>{var l;return[i.theme,(l=i.state)==null?void 0:l.getInternalStack(i.theme)]})),s[0].state.lang):void 0;return c&&z(a,c),a}function Ue(...n){const t=n.map(()=>[]),e=n.length;for(let r=0;r<n[0].length;r++){const s=n.map(i=>i[r]),o=t.map(()=>[]);t.forEach((i,l)=>i.push(o[l]));const a=s.map(()=>0),c=s.map(i=>i[0]);for(;c.every(i=>i);){const i=Math.min(...c.map(l=>l.content.length));for(let l=0;l<e;l++){const u=c[l];u.content.length===i?(o[l].push(u),a[l]+=1,c[l]=s[l][a[l]]):(o[l].push({...u,content:u.content.slice(0,i)}),c[l]={...u,content:u.content.slice(i),offset:u.offset+i})}}}return t}function P(n,t,e){let r,s,o,a,c,i;if("themes"in e){const{defaultColor:l="light",cssVariablePrefix:u="--shiki-"}=e,h=Object.entries(e.themes).filter(g=>g[1]).map(g=>({color:g[0],theme:g[1]})).sort((g,m)=>g.color===l?-1:m.color===l?1:0);if(h.length===0)throw new E("`themes` option must not be empty");const f=ge(n,t,e);if(i=R(f),l&&!h.find(g=>g.color===l))throw new E(`\`themes\` option must contain the defaultColor key \`${l}\``);const d=h.map(g=>n.getTheme(g.theme)),y=h.map(g=>g.color);o=f.map(g=>g.map(m=>Ke(m,y,u,l))),i&&z(o,i);const S=h.map(g=>W(g.theme,e));s=h.map((g,m)=>(m===0&&l?"":`${u+g.color}:`)+($(d[m].fg,S[m])||"inherit")).join(";"),r=h.map((g,m)=>(m===0&&l?"":`${u+g.color}-bg:`)+($(d[m].bg,S[m])||"inherit")).join(";"),a=`shiki-themes ${d.map(g=>g.name).join(" ")}`,c=l?void 0:[s,r].join(";")}else if("theme"in e){const l=W(e.theme,e);o=Q(n,t,e);const u=n.getTheme(e.theme);r=$(u.bg,l),s=$(u.fg,l),a=u.name,i=R(o)}else throw new E("Invalid options, either `theme` or `themes` must be provided");return{tokens:o,fg:s,bg:r,themeName:a,rootStyle:c,grammarState:i}}function Ke(n,t,e,r){const s={content:n.content,explanation:n.explanation,offset:n.offset},o=t.map(i=>fe(n.variants[i])),a=new Set(o.flatMap(i=>Object.keys(i))),c={};return o.forEach((i,l)=>{for(const u of a){const h=i[u]||"inherit";if(l===0&&r)c[u]=h;else{const f=u==="color"?"":u==="background-color"?"-bg":`-${u}`,d=e+t[l]+(u==="color"?"":f);c[d]=h}}}),s.htmlStyle=c,s}function D(n,t,e,r={meta:{},options:e,codeToHast:(s,o)=>D(n,s,o),codeToTokens:(s,o)=>P(n,s,o)}){var d,y;let s=t;for(const S of B(e))s=((d=S.preprocess)==null?void 0:d.call(r,s,e))||s;let{tokens:o,fg:a,bg:c,themeName:i,rootStyle:l,grammarState:u}=P(n,s,e);const{mergeWhitespaces:h=!0}=e;h===!0?o=qe(o):h==="never"&&(o=Qe(o));const f={...r,get source(){return s}};for(const S of B(e))o=((y=S.tokens)==null?void 0:y.call(f,o))||o;return Ye(o,{...e,fg:a,bg:c,themeName:i,rootStyle:l},f,u)}function Ye(n,t,e,r=R(n)){var y,S,g;const s=B(t),o=[],a={type:"root",children:[]},{structure:c="classic",tabindex:i="0"}=t;let l={type:"element",tagName:"pre",properties:{class:`shiki ${t.themeName||""}`,style:t.rootStyle||`background-color:${t.bg};color:${t.fg}`,...i!==!1&&i!=null?{tabindex:i.toString()}:{},...Object.fromEntries(Array.from(Object.entries(t.meta||{})).filter(([m])=>!m.startsWith("_")))},children:[]},u={type:"element",tagName:"code",properties:{},children:o};const h=[],f={...e,structure:c,addClassToHast:ce,get source(){return e.source},get tokens(){return n},get options(){return t},get root(){return a},get pre(){return l},get code(){return u},get lines(){return h}};if(n.forEach((m,p)=>{var L,x;p&&(c==="inline"?a.children.push({type:"element",tagName:"br",properties:{},children:[]}):c==="classic"&&o.push({type:"text",value:`
`}));let b={type:"element",tagName:"span",properties:{class:"line"},children:[]},T=0;for(const _ of m){let C={type:"element",tagName:"span",properties:{..._.htmlAttrs},children:[{type:"text",value:_.content}]};_.htmlStyle;const A=xe(_.htmlStyle||fe(_));A&&(C.properties.style=A);for(const j of s)C=((L=j==null?void 0:j.span)==null?void 0:L.call(f,C,p+1,T,b,_))||C;c==="inline"?a.children.push(C):c==="classic"&&b.children.push(C),T+=_.content.length}if(c==="classic"){for(const _ of s)b=((x=_==null?void 0:_.line)==null?void 0:x.call(f,b,p+1))||b;h.push(b),o.push(b)}}),c==="classic"){for(const m of s)u=((y=m==null?void 0:m.code)==null?void 0:y.call(f,u))||u;l.children.push(u);for(const m of s)l=((S=m==null?void 0:m.pre)==null?void 0:S.call(f,l))||l;a.children.push(l)}let d=a;for(const m of s)d=((g=m==null?void 0:m.root)==null?void 0:g.call(f,d))||d;return r&&z(d,r),d}function qe(n){return n.map(t=>{const e=[];let r="",s=0;return t.forEach((o,a)=>{const i=!(o.fontStyle&&o.fontStyle&N.Underline);i&&o.content.match(/^\s+$/)&&t[a+1]?(s||(s=o.offset),r+=o.content):r?(i?e.push({...o,offset:s,content:r+o.content}):e.push({content:r,offset:s},o),s=0,r=""):e.push(o)}),e})}function Qe(n){return n.map(t=>t.flatMap(e=>{if(e.content.match(/^\s+$/))return e;const r=e.content.match(/^(\s*)(.*?)(\s*)$/);if(!r)return e;const[,s,o,a]=r;if(!s&&!a)return e;const c=[{...e,offset:e.offset+s.length,content:o}];return s&&c.unshift({content:s,offset:e.offset}),a&&c.push({content:a,offset:e.offset+s.length+o.length}),c}))}function Xe(n,t,e){var o;const r={meta:{},options:e,codeToHast:(a,c)=>D(n,a,c),codeToTokens:(a,c)=>P(n,a,c)};let s=Te(D(n,t,e,r));for(const a of B(e))s=((o=a.postprocess)==null?void 0:o.call(r,s,e))||s;return s}const oe={light:"#333333",dark:"#bbbbbb"},ae={light:"#fffffe",dark:"#1e1e1e"},ie="__shiki_resolved";function X(n){var c,i,l,u,h;if(n!=null&&n[ie])return n;const t={...n};t.tokenColors&&!t.settings&&(t.settings=t.tokenColors,delete t.tokenColors),t.type||(t.type="dark"),t.colorReplacements={...t.colorReplacements},t.settings||(t.settings=[]);let{bg:e,fg:r}=t;if(!e||!r){const f=t.settings?t.settings.find(d=>!d.name&&!d.scope):void 0;(c=f==null?void 0:f.settings)!=null&&c.foreground&&(r=f.settings.foreground),(i=f==null?void 0:f.settings)!=null&&i.background&&(e=f.settings.background),!r&&((l=t==null?void 0:t.colors)!=null&&l["editor.foreground"])&&(r=t.colors["editor.foreground"]),!e&&((u=t==null?void 0:t.colors)!=null&&u["editor.background"])&&(e=t.colors["editor.background"]),r||(r=t.type==="light"?oe.light:oe.dark),e||(e=t.type==="light"?ae.light:ae.dark),t.fg=r,t.bg=e}t.settings[0]&&t.settings[0].settings&&!t.settings[0].scope||t.settings.unshift({settings:{foreground:t.fg,background:t.bg}});let s=0;const o=new Map;function a(f){var y;if(o.has(f))return o.get(f);s+=1;const d=`#${s.toString(16).padStart(8,"0").toLowerCase()}`;return(y=t.colorReplacements)!=null&&y[`#${d}`]?a(f):(o.set(f,d),d)}t.settings=t.settings.map(f=>{var g,m;const d=((g=f.settings)==null?void 0:g.foreground)&&!f.settings.foreground.startsWith("#"),y=((m=f.settings)==null?void 0:m.background)&&!f.settings.background.startsWith("#");if(!d&&!y)return f;const S={...f,settings:{...f.settings}};if(d){const p=a(f.settings.foreground);t.colorReplacements[p]=f.settings.foreground,S.settings.foreground=p}if(y){const p=a(f.settings.background);t.colorReplacements[p]=f.settings.background,S.settings.background=p}return S});for(const f of Object.keys(t.colors||{}))if((f==="editor.foreground"||f==="editor.background"||f.startsWith("terminal.ansi"))&&!((h=t.colors[f])!=null&&h.startsWith("#"))){const d=a(t.colors[f]);t.colorReplacements[d]=t.colors[f],t.colors[f]=d}return Object.defineProperty(t,ie,{enumerable:!1,writable:!1,value:!0}),t}async function me(n){return Array.from(new Set((await Promise.all(n.filter(t=>!Le(t)).map(async t=>await le(t).then(e=>Array.isArray(e)?e:[e])))).flat()))}async function de(n){return(await Promise.all(n.map(async e=>Ce(e)?null:X(await le(e))))).filter(e=>!!e)}class Ze extends _e{constructor(e,r,s,o={}){super(e);k(this,"_resolvedThemes",new Map);k(this,"_resolvedGrammars",new Map);k(this,"_langMap",new Map);k(this,"_langGraph",new Map);k(this,"_textmateThemeCache",new WeakMap);k(this,"_loadedThemesCache",null);k(this,"_loadedLanguagesCache",null);this._resolver=e,this._themes=r,this._langs=s,this._alias=o,this._themes.map(a=>this.loadTheme(a)),this.loadLanguages(this._langs)}getTheme(e){return typeof e=="string"?this._resolvedThemes.get(e):this.loadTheme(e)}loadTheme(e){const r=X(e);return r.name&&(this._resolvedThemes.set(r.name,r),this._loadedThemesCache=null),r}getLoadedThemes(){return this._loadedThemesCache||(this._loadedThemesCache=[...this._resolvedThemes.keys()]),this._loadedThemesCache}setTheme(e){let r=this._textmateThemeCache.get(e);r||(r=we.createFromRawTheme(e),this._textmateThemeCache.set(e,r)),this._syncRegistry.setTheme(r)}getGrammar(e){if(this._alias[e]){const r=new Set([e]);for(;this._alias[e];){if(e=this._alias[e],r.has(e))throw new w(`Circular alias \`${Array.from(r).join(" -> ")} -> ${e}\``);r.add(e)}}return this._resolvedGrammars.get(e)}loadLanguage(e){var a,c,i,l;if(this.getGrammar(e.name))return;const r=new Set([...this._langMap.values()].filter(u=>{var h;return(h=u.embeddedLangsLazy)==null?void 0:h.includes(e.name)}));this._resolver.addLanguage(e);const s={balancedBracketSelectors:e.balancedBracketSelectors||["*"],unbalancedBracketSelectors:e.unbalancedBracketSelectors||[]};this._syncRegistry._rawGrammars.set(e.scopeName,e);const o=this.loadGrammarWithConfiguration(e.scopeName,1,s);if(o.name=e.name,this._resolvedGrammars.set(e.name,o),e.aliases&&e.aliases.forEach(u=>{this._alias[u]=e.name}),this._loadedLanguagesCache=null,r.size)for(const u of r)this._resolvedGrammars.delete(u.name),this._loadedLanguagesCache=null,(c=(a=this._syncRegistry)==null?void 0:a._injectionGrammars)==null||c.delete(u.scopeName),(l=(i=this._syncRegistry)==null?void 0:i._grammars)==null||l.delete(u.scopeName),this.loadLanguage(this._langMap.get(u.name))}dispose(){super.dispose(),this._resolvedThemes.clear(),this._resolvedGrammars.clear(),this._langMap.clear(),this._langGraph.clear(),this._loadedThemesCache=null}loadLanguages(e){for(const o of e)this.resolveEmbeddedLanguages(o);const r=Array.from(this._langGraph.entries()),s=r.filter(([o,a])=>!a);if(s.length){const o=r.filter(([a,c])=>{var i;return c&&((i=c.embeddedLangs)==null?void 0:i.some(l=>s.map(([u])=>u).includes(l)))}).filter(a=>!s.includes(a));throw new w(`Missing languages ${s.map(([a])=>`\`${a}\``).join(", ")}, required by ${o.map(([a])=>`\`${a}\``).join(", ")}`)}for(const[o,a]of r)this._resolver.addLanguage(a);for(const[o,a]of r)this.loadLanguage(a)}getLoadedLanguages(){return this._loadedLanguagesCache||(this._loadedLanguagesCache=[...new Set([...this._resolvedGrammars.keys(),...Object.keys(this._alias)])]),this._loadedLanguagesCache}resolveEmbeddedLanguages(e){if(this._langMap.set(e.name,e),this._langGraph.set(e.name,e),e.embeddedLangs)for(const r of e.embeddedLangs)this._langGraph.set(r,this._langMap.get(r))}}class et{constructor(t,e){k(this,"_langs",new Map);k(this,"_scopeToLang",new Map);k(this,"_injections",new Map);k(this,"_onigLib");this._onigLib={createOnigScanner:r=>t.createScanner(r),createOnigString:r=>t.createString(r)},e.forEach(r=>this.addLanguage(r))}get onigLib(){return this._onigLib}getLangRegistration(t){return this._langs.get(t)}loadGrammar(t){return this._scopeToLang.get(t)}addLanguage(t){this._langs.set(t.name,t),t.aliases&&t.aliases.forEach(e=>{this._langs.set(e,t)}),this._scopeToLang.set(t.scopeName,t),t.injectTo&&t.injectTo.forEach(e=>{this._injections.get(e)||this._injections.set(e,[]),this._injections.get(e).push(t.scopeName)})}getInjections(t){const e=t.split(".");let r=[];for(let s=1;s<=e.length;s++){const o=e.slice(0,s).join(".");r=[...r,...this._injections.get(o)||[]]}return r}}let G=0;function tt(n){G+=1,n.warnings!==!1&&G>=10&&G%10===0&&console.warn(`[Shiki] ${G} instances have been created. Shiki is supposed to be used as a singleton, consider refactoring your code to cache your highlighter instance; Or call \`highlighter.dispose()\` to release unused instances.`);let t=!1;if(!n.engine)throw new w("`engine` option is required for synchronous mode");const e=(n.langs||[]).flat(1),r=(n.themes||[]).flat(1).map(X),s=new et(n.engine,e),o=new Ze(s,r,e,n.langAlias);let a;function c(p){g();const b=o.getGrammar(typeof p=="string"?p:p.name);if(!b)throw new w(`Language \`${p}\` not found, you may need to load it first`);return b}function i(p){if(p==="none")return{bg:"",fg:"",name:"none",settings:[],type:"dark"};g();const b=o.getTheme(p);if(!b)throw new w(`Theme \`${p}\` not found, you may need to load it first`);return b}function l(p){g();const b=i(p);a!==p&&(o.setTheme(b),a=p);const T=o.getColorMap();return{theme:b,colorMap:T}}function u(){return g(),o.getLoadedThemes()}function h(){return g(),o.getLoadedLanguages()}function f(...p){g(),o.loadLanguages(p.flat(1))}async function d(...p){return f(await me(p))}function y(...p){g();for(const b of p.flat(1))o.loadTheme(b)}async function S(...p){return g(),y(await de(p))}function g(){if(t)throw new w("Shiki instance has been disposed")}function m(){t||(t=!0,o.dispose(),G-=1)}return{setTheme:l,getTheme:i,getLanguage:c,getLoadedThemes:u,getLoadedLanguages:h,loadLanguage:d,loadLanguageSync:f,loadTheme:S,loadThemeSync:y,dispose:m,[Symbol.dispose]:m}}async function nt(n={}){n.loadWasm;const[t,e,r]=await Promise.all([de(n.themes||[]),me(n.langs||[]),n.engine||be(n.loadWasm||Se())]);return tt({...n,themes:t,langs:e,engine:r})}async function ft(n={}){const t=await nt(n);return{getLastGrammarState:(...e)=>Pe(t,...e),codeToTokensBase:(e,r)=>Q(t,e,r),codeToTokensWithThemes:(e,r)=>ge(t,e,r),codeToTokens:(e,r)=>P(t,e,r),codeToHast:(e,r)=>D(t,e,r),codeToHtml:(e,r)=>Xe(t,e,r),...t,getInternalContext:()=>t}}export{N as FontStyle,E as ShikiError,te as StackElementMetadata,ce as addClassToHast,$ as applyColorReplacements,D as codeToHast,Xe as codeToHtml,P as codeToTokens,Q as codeToTokensBase,ge as codeToTokensWithThemes,ft as createHighlighterCore,$e as createPositionConverter,nt as createShikiInternal,tt as createShikiInternalSync,fe as getTokenStyleObject,Te as hastToHtml,q as isNoneTheme,Y as isPlainLang,Le as isSpecialLang,Ce as isSpecialTheme,le as normalizeGetter,X as normalizeTheme,W as resolveColorReplacements,H as splitLines,ve as splitToken,Ne as splitTokens,xe as stringifyTokenStyle,ke as toArray,Be as tokenizeAnsiWithTheme,De as tokenizeWithTheme,Ye as tokensToHast,Ee as transformerDecorations};
