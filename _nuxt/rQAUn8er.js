import{d as re,l as F,an as ae,r as ce,aj as ie,ak as fe,U as ue,ao as pe,ap as de,n as P,p as R,P as W,C as V,j as I,B as q,V as X,Z as he,_ as me}from"./CuGlreuw.js";function Z(n,e,t,s){let o=0;for(;o<n.length;o++){const g=(t==null?void 0:t(o))??e[o];if(n[o]!==g||s!=null&&s(o))break}let l=n.length-1,h=e.length-1;for(;l>=0&&h>=0;l--,h--){const g=(t==null?void 0:t(h))??e[h];if(n[l]!==g||s!=null&&s(h))break}return o>l&&([o,l]=[l,o]),o=Math.max(0,o),l=Math.min(n.length-1,l)+1,n.length===e.length&&o+1===l?[o,l]:ge([...n],o,l)}function ge(n,e,t){const s=o(Math.max(0,e+t-n.length));e-=s,t+=s;function o(m){const a=n.slice(0,e).indexOf(n[t],m);if(a===-1)return 0;for(let r=a,i=t;r<e-1;i++,r++)if(n[r+1]!==n[i+1])return o(m+1);return e-a}const l=n.join(`
`),h=n.slice(0,e).join(`
`).length,g=n.slice(0,t).join(`
`).length,_=[];for(let m=e-1,a=g-1;m<t&&a>=h;m--){const r=n[m],i=l.lastIndexOf(r,a);if(i!==-1&&i>=h)_.push(r),a=i-1;else break}const v=[];for(let m=t,a=h;m>=e&&a<g;m++){const r=n[m],i=l.indexOf(r,a);if(i!==-1&&i<g)v.push(r),a=i+1;else break}return[e-_.length,t+v.length]}function Se(n,e){let t=0,s;return function(...o){s&&(clearTimeout(s),s=void 0);const l=performance.now();!t||l-t>=e?(n.apply(this,o),t=l):s=setTimeout(()=>{n.apply(this,o),t=performance.now(),s=void 0},e+t-l)}}function ke(n){let e=!1;return function(...t){return e?!1:(e=!0,n.apply(this,t),!0)}}function ye(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ce(n){const e=()=>"CSS"in globalThis&&"highlights"in CSS;function t(s,o){const{lang:l,themes:h={light:"min-light",dark:"min-dark"},defaultTheme:g="light",selector:_=C=>`.${C}`,defaultSelector:v=":root",watch:m=!0,delay:a=33.4}=o,r=new CSSStyleSheet;document.adoptedStyleSheets.push(r);const i=new Map,c=[];function U(C,d){for(const{range:S,name:p}of z(d)){const f=CSS.highlights.get(p);f==null||f.delete(S);const u=i.get(p);u==null||u.delete(S)}for(const{range:S,color:p,theme:f,name:u}of z(C)){const k=f===g;let w=CSS.highlights.get(u);w||(CSS.highlights.set(u,w=new Highlight),w.priority=k?0:1);let b=i.get(u);if(!b){i.set(u,b=new Set);const x=`${k?v:_(f)}::highlight(${u}) { color: ${p}; }`;r.insertRule(x)}w.add(S),b.add(S)}}function K(C,d,S){var O;if(S-d>1||c.length<=d)return;const p=C[d],f=c[d],u=Z(p,f.text),k=f.offset+u[0],w=f.offset+u[1],b=(O=f.loads)==null?void 0:O.find(({range:j})=>k>=j.startOffset&&k<j.endOffset);if(!b)return;const{range:x}=b;x.setEnd(x.endContainer,Math.max(x.endOffset,w))}const Q=Se((C,d,S,p,f)=>{var O,j,A,D,H;const u=f-d.length+c.length,k=c.splice(u);for(let y=p;y<u;y++)U([],((O=c[y])==null?void 0:O.loads)??[]);const w=(j=c.at(-1))==null?void 0:j.lastGrammarState;c.length=f-1,c.fill(null,p,f-1),c.push(J({lastGrammarState:w}),...k);let b=d.slice(0,p).reduce((y,E)=>y+E.length+1,0);const x=ve(C,S,b);for(let y=p;y<d.length;y++){const E=d[y],G=n.codeToTokens(E,{lang:l,themes:h,cssVariablePrefix:"",defaultColor:!1,grammarState:(A=c[y-1])==null?void 0:A.lastGrammarState}),M=[];for(const B of G.tokens[0]){const[ne,oe]=x(b+B.offset),[se,le]=x(b+B.offset+B.content.length),T=document.createRange();T.setStart(ne,oe),T.setEnd(se,le),M.push({token:B,range:T})}const N=c[y]??(c[y]=J());U(M,N.loads),N.loads=M,N.text=E,N.offset=b;const L=((D=N.lastGrammarState)==null?void 0:D.getScopes())??[Number.NaN],ee=((H=G.grammarState)==null?void 0:H.getScopes())??[Number.NaN],te=ye(L,ee);if(N.lastGrammarState=G.grammarState,!te)b+=E.length+1;else break}},a);e()&&(m&&s.addEventListener("input",$),$());const Y=ke(()=>{m&&s.removeEventListener("input",$);const C=document.adoptedStyleSheets.indexOf(r);document.adoptedStyleSheets.splice(C,1);for(const[d,S]of i){const p=CSS.highlights.get(d);for(const f of S)p==null||p.delete(f)}});function $(){const{innerText:C}=s,d=C.split(`
`),S=be(s),[p,f]=Z(d,c,u=>{var k;return(k=c[u])==null?void 0:k.text},u=>{var k;return(k=c[u])==null?void 0:k.loads.some(({range:w})=>w.collapsed)});K(d,p,f),Q(C,d,S,p,f)}return{dispose:Y,update:$}}return{get isSupported(){return e()},mount:t}}function*z(n){for(const{token:e,range:t}of n)if(typeof e.htmlStyle=="object")for(const s in e.htmlStyle){const o=e.htmlStyle[s],l=`shiki-${s}-${o.slice(1).toLowerCase()}`;yield{range:t,color:o,theme:s,name:l}}}function be(n){const e=document.createTreeWalker(n,NodeFilter.SHOW_TEXT),t=[];let s;for(;s=e.nextNode();)t.push(s);return t}function J(n={}){return{text:"",offset:0,lastGrammarState:void 0,loads:[],...n}}function ve(n,e,t){let s=0,o=0,l=!1;return t>0&&h(t),h;function h(g){for(;s<e.length;s++){const _=e[s],{textContent:v}=_;if(v)if(l||(o=n.indexOf(v,o),l=!0),o+v.length<g)o+=v.length,l=!1;else break}return[e[s],g-o]}}const we={class:"copy"},_e={key:0,class:"prompt"},xe=["textContent"],Ne=re({__name:"Copy",props:{prompt:{type:[String,Boolean],default:"$"},code:{},lang:{}},setup(n){const e=n,t=F(()=>e.prompt!==!0),s=F(()=>e.lang??ae(e.prompt)),o=ce(!1),l=ie("code-input"),{copy:h,copied:g}=fe(l);function _(){l.value&&(l.value.textContent=e.code??"",l.value.dispatchEvent(new Event("input")),o.value=!1)}function v(a){const{data:r,inputType:i}=a;(r!=null&&r.includes(`
`)||i==="insertLineBreak")&&a.preventDefault()}function m(a){o.value=e.code!==a.target.textContent}return ue(async()=>{const a=await pe(),r=await de({lang:s.value});Ce(a).mount(l.value,r)}),(a,r)=>{const i=he;return R(),P("code",we,[I(t)?(R(),P("span",_e,q(a.prompt),1)):W("",!0),V("div",{ref:"code-input",contenteditable:"plaintext-only",class:"code",spellcheck:"false",onBeforeinput:r[0]||(r[0]=c=>v(c)),onInput:r[1]||(r[1]=c=>m(c)),textContent:q(a.code)},null,40,xe),r[3]||(r[3]=V("div",{class:"mask"},null,-1)),I(o)?(R(),P("button",{key:1,class:"operation","aria-label":"恢复原始内容",onClick:_},[X(i,{name:"ph:arrow-u-up-left-bold"})])):W("",!0),V("button",{class:"operation","aria-label":"复制",onClick:r[2]||(r[2]=c=>I(h)())},[X(i,{name:I(g)?"ph:check-bold":"ph:copy-bold"},null,8,["name"])])])}}}),je=Object.assign(me(Ne,[["__scopeId","data-v-b8f384bf"]]),{__name:"Copy"});export{je as default};
